<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaddio P2P File Transfer</title>
</head>
<body>
    <header>
        <h1>🔐 Kaddio P2P File Transfer</h1>
        <p><strong>Secure, open source, direct file sharing between browsers</strong></p>
    </header>
    
    <main>
        <!-- MODE TOGGLE -->
        <section id="mode-selector">
            <h2>� Choose Your Action</h2>
            <fieldset>
                <legend>What do you want to do?</legend>
                <div style="display: flex; gap: 20px; justify-content: center; margin: 20px 0;">
                    <label style="display: flex; flex-direction: column; align-items: center; padding: 15px; border: 2px solid #007acc; border-radius: 8px; cursor: pointer; background: #f0f8ff;">
                        <input type="radio" name="mode" value="send" id="sendMode" checked style="margin-bottom: 10px;">
                        <strong>📤 Send a File</strong>
                        <small>Share a file from this device</small>
                    </label>
                    <label style="display: flex; flex-direction: column; align-items: center; padding: 15px; border: 2px solid #28a745; border-radius: 8px; cursor: pointer; background: #f0fff0;">
                        <input type="radio" name="mode" value="receive" id="receiveMode" style="margin-bottom: 10px;">
                        <strong>📥 Receive a File</strong>
                        <small>Get a file someone is sharing</small>
                    </label>
                </div>
            </fieldset>
        </section>
        
        <section>
            <h2>📋 How This Works</h2>
            <details>
                <summary><strong>Simple Process</strong></summary>
                <div id="sendInstructions">
                    <h3>📤 Sending Files:</h3>
                    <ol>
                        <li>Choose a file from your device</li>
                        <li>Click "Create Share Link"</li>
                        <li>Send the generated link to someone</li>
                        <li>Wait for them to connect and receive the file</li>
                    </ol>
                </div>
                <div id="receiveInstructions" hidden>
                    <h3>📥 Receiving Files:</h3>
                    <ol>
                        <li>Get a share link from someone</li>
                        <li>Paste the link in the input field below</li>
                        <li>Click "Connect to Sender"</li>
                        <li>Accept the file transfer when prompted</li>
                    </ol>
                </div>
                <p><mark>⚠️ IMPORTANT: Both browsers must stay open during the entire transfer!</mark></p>
                <p>🔒 Your files are encrypted and transfer directly between browsers - no servers involved!</p>
                <p><strong>🌐 Requires a modern browser:</strong> Chrome, Firefox, Safari, or Edge (WebRTC support needed)</p>
                
                <details>
                    <summary><strong>📏 File Size Limits & Performance</strong></summary>
                    <h4>File Size Guidelines:</h4>
                    <ul>
                        <li><strong>✅ Small files (up to 100MB):</strong> Transfer quickly and reliably</li>
                        <li><strong>⚠️ Medium files (100MB - 1GB):</strong> Work well, but take longer to transfer</li>
                        <li><strong>🐌 Large files (1GB+):</strong> Possible but slow, requires stable connection</li>
                        <li><strong>⚡ Very large files (5GB+):</strong> May fail due to browser memory limits</li>
                    </ul>
                    
                    <h4>Performance Tips:</h4>
                    <ul>
                        <li><strong>💪 RAM Usage:</strong> Large files use significant browser memory during transfer</li>
                        <li><strong>🌐 Connection Quality:</strong> Stable, fast internet gives better results</li>
                        <li><strong>⏱️ Time Estimates:</strong> ~1-5 minutes per 100MB depending on connection</li>
                        <li><strong>🔄 For huge files:</strong> Consider splitting into smaller parts</li>
                    </ul>
                    
                    <p><em>💡 Tip: Test with a small file first to ensure your connection works!</em></p>
                </details>
            </details>
        </section>
        
        <!-- SEND MODE SECTIONS -->
        <div id="send-sections">
            <!-- STEP 1: FILE SELECTION -->
            <section id="file-section">
                <h2>📁 Step 1: Select Your File</h2>
                <fieldset>
                    <legend>Choose the file you want to share</legend>
                    <input type="file" id="fileInput" required>
                    <br><br>
                    <output id="fileInfo" hidden>
                        <strong>✅ File Selected:</strong><br>
                        📄 <strong>Name:</strong> <span id="fileName"></span><br>
                        📏 <strong>Size:</strong> <span id="fileSize"></span><br>
                        🏷️ <strong>Type:</strong> <span id="fileType"></span>
                    </output>
                </fieldset>
            </section>

            <!-- STEP 2: CREATE SHARE LINK -->
            <section id="connection-section">
                <h2>🔗 Step 2: Create Share Link</h2>
                <fieldset>
                    <legend>Generate a secure link to share</legend>
                    <button id="createOfferBtn" disabled>🚀 Create Share Link</button>
                    
                    <details id="shareUrlContainer" hidden>
                        <summary><strong>📋 Your Share Link (Click to Copy)</strong></summary>
                        <textarea id="shareUrl" readonly rows="3" style="width: 100%; font-family: monospace;"></textarea>
                        <button id="copyUrlBtn">📋 Copy Link to Clipboard</button>
                    </details>
                    
                    <div id="waitingStatus" hidden>
                        <p><strong>⏳ Status:</strong> Waiting for someone to connect...</p>
                        <progress indeterminate>Waiting...</progress>
                    </div>
                    
                    <details id="manualExchange" hidden>
                        <summary><strong>🔧 Manual Exchange (if link doesn't work)</strong></summary>
                        <p>If the automatic link doesn't work, you can manually exchange connection data:</p>
                        <ol>
                            <li>Send the link above to the receiver</li>
                            <li>Ask them to send you back their "answer code"</li>
                            <li>Paste their answer code below:</li>
                        </ol>
                        <textarea id="answerInput" placeholder="Paste the answer code from receiver here..." 
                                 rows="4" style="width: 100%; font-family: monospace;"></textarea>
                        <br><br>
                        <button id="processAnswerBtn">🔌 Connect Using Answer Code</button>
                    </details>
                </fieldset>
            </section>
        </div>

        <!-- RECEIVE MODE SECTIONS -->
        <div id="receive-sections" hidden>
            <!-- STEP 1: ENTER SHARE LINK -->
            <section id="link-input-section">
                <h2>🔗 Step 1: Enter Share Link</h2>
                <fieldset>
                    <legend>Paste the link someone shared with you</legend>
                    <textarea id="shareLinkInput" placeholder="Paste the share link here..." 
                             rows="3" style="width: 100%; font-family: monospace;"></textarea>
                    <br><br>
                    <button id="processLinkBtn">🔌 Connect to Sender</button>
                </fieldset>
            </section>

            <!-- STEP 2: RECEIVE FILE (For receivers) -->
            <section id="receive-section">
                <h2>📥 Step 2: Receive File</h2>
                <fieldset>
                    <legend>Accept incoming file transfer</legend>
                    <output id="receiveInfo">
                        <p>File details will appear here when you connect to a sender...</p>
                    </output>
                    <br>
                    <button id="connectBtn" disabled>✅ Accept File Transfer</button>
                    
                    <details id="answerDisplay" hidden>
                        <summary><strong>📤 Answer Code (Send this back to sender)</strong></summary>
                        <p>Copy this code and send it back to the person sharing the file:</p>
                        <textarea id="answerText" readonly rows="4" style="width: 100%; font-family: monospace;"></textarea>
                        <button id="copyAnswerBtn">📋 Copy Answer Code</button>
                    </details>
                </fieldset>
            </section>
        </div>

        <!-- STEP 3: TRANSFER STATUS -->
        <section id="transfer-section">
            <h2>📤 Step 3: File Transfer</h2>
            <fieldset>
                <legend>Transfer progress and status</legend>
                <output id="connectionStatus" hidden>
                    Connection status will appear here...
                </output>
                <br>
                <label for="progressBar">Transfer Progress:</label>
                <progress id="progressBar" value="0" max="100" hidden>0%</progress>
                <output id="progressText">Ready to transfer...</output>
            </fieldset>
        </section>
    </main>

    <footer>
        <details>
            <summary><strong>🆘 Troubleshooting</strong></summary>
            <h3>Common Issues:</h3>
            <dl>
                <dt><strong>Connection failed?</strong></dt>
                <dd>• Make sure both people have the page open<br>
                    • Try refreshing and creating a new link<br>
                    • Check your internet connection</dd>
                
                <dt><strong>Transfer stuck?</strong></dt>
                <dd>• Don't close the browser tab during transfer<br>
                    • Large files take longer - be patient<br>
                    • Try with a smaller file first</dd>
                
                <dt><strong>Can't download?</strong></dt>
                <dd>• Check if your browser blocked the download<br>
                    • Look for download notification in browser<br>
                    • Use a modern browser (Chrome, Firefox, Safari, Edge)</dd>
                
                <dt><strong>Large file problems?</strong></dt>
                <dd>• Files over 1GB may be slow or fail<br>
                    • Close other browser tabs to free memory<br>
                    • Use a wired internet connection if possible<br>
                    • Consider splitting very large files into parts</dd>
                
                <dt><strong>Browser crashes or freezes?</strong></dt>
                <dd>• File may be too large for available RAM<br>
                    • Try with a smaller file (under 500MB)<br>
                    • Restart browser and try again<br>
                    • Requires modern browser with WebRTC support</dd>
            </dl>
        </details>
    </footer>

    <script src="p2p-transfer.js"></script>
</body>
</html>