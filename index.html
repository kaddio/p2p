<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kaddio P2P File Transfer</title>
    <style>
        /* Prevent iOS zoom on input fields */
        input, textarea, select {
            font-size: 16px !important;
        }
        
        /* Ensure buttons are also properly sized */
        button {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ” Kaddio P2P File Transfer</h1>
        <p><strong>Secure, open source, direct file sharing between browsers</strong></p>
    </header>
    
    <main>
        <!-- MODE TOGGLE -->
        <section id="mode-selector">
            <h2>ï¿½ Choose Your Action</h2>
            <fieldset>
                <legend>What do you want to do?</legend>
                <div style="display: flex; gap: 20px; justify-content: center; margin: 20px 0;">
                    <label style="display: flex; flex-direction: column; align-items: center; padding: 15px; border: 2px solid #007acc; border-radius: 8px; cursor: pointer; background: #f0f8ff;">
                        <input type="radio" name="mode" value="send" id="sendMode" checked style="margin-bottom: 10px;">
                        <strong>ğŸ“¤ Send a File</strong>
                        <small>Share a file from this device</small>
                    </label>
                    <label style="display: flex; flex-direction: column; align-items: center; padding: 15px; border: 2px solid #28a745; border-radius: 8px; cursor: pointer; background: #f0fff0;">
                        <input type="radio" name="mode" value="receive" id="receiveMode" style="margin-bottom: 10px;">
                        <strong>ğŸ“¥ Receive a File</strong>
                        <small>Get a file someone is sharing</small>
                    </label>
                </div>
            </fieldset>
        </section>
        
        <!-- SEND MODE SECTIONS -->
        <div id="send-sections">
            <!-- FILE SELECTION -->
            <section id="file-section">
                <h2>ğŸ“ Choose Your File</h2>
                <fieldset>
                    <legend>Select the file you want to share</legend>
                    <input type="file" id="fileInput" required>
                    <br><br>
                    <output id="fileInfo" hidden>
                        <strong>âœ… File Ready:</strong><br>
                        ğŸ“„ <span id="fileName"></span><br>
                        ğŸ“ <span id="fileSize"></span><br>
                        ğŸ·ï¸ <span id="fileType"></span>
                    </output>
                </fieldset>
            </section>

            <!-- SHARE LINK -->
            <section id="connection-section">
                <h2>ğŸ”— Create & Share Link</h2>
                <fieldset>
                    <legend>Generate your share link</legend>
                    <button id="createOfferBtn" disabled>ğŸš€ Create Share Link</button>
                    
                    <details id="shareUrlContainer" hidden>
                        <summary><strong>ğŸ“‹ Share This Link</strong></summary>
                        <textarea id="shareUrl" readonly rows="3" style="width: 100%; font-family: monospace; margin: 10px 0;"></textarea>
                        <button id="copyUrlBtn">ğŸ“‹ Copy Link</button>
                        <p><small>Send this link to the person you want to share with</small></p>
                    </details>
                    
                    <div id="waitingStatus" hidden>
                        <p><strong>â³ Waiting for connection...</strong></p>
                        <progress indeterminate>Waiting...</progress>
                    </div>
                    
                    <details id="manualExchange" hidden>
                        <summary><strong>ğŸ”§ Manual Connection</strong></summary>
                        <p>If the automatic connection doesn't work:</p>
                        <textarea id="answerInput" placeholder="Paste answer code from receiver here..." 
                                 rows="3" style="width: 100%; font-family: monospace; margin: 10px 0;"></textarea>
                        <button id="processAnswerBtn">ğŸ”Œ Connect</button>
                    </details>
                </fieldset>
            </section>
        </div>

        <!-- RECEIVE MODE SECTIONS -->
        <div id="receive-sections" hidden>
            <!-- LINK INPUT -->
            <section id="link-input-section">
                <h2>ğŸ”— Enter Share Link</h2>
                <fieldset>
                    <legend>Paste the link someone shared with you</legend>
                    <textarea id="shareLinkInput" placeholder="Paste share link here..." 
                             rows="3" style="width: 100%; font-family: monospace; margin: 10px 0;"></textarea>
                    <button id="processLinkBtn">ğŸ”Œ Connect</button>
                </fieldset>
            </section>

            <!-- FILE DETAILS & ACCEPT -->
            <section id="receive-section">
                <h2>ğŸ“¥ Incoming File</h2>
                <fieldset>
                    <legend>File transfer details</legend>
                    <output id="receiveInfo">
                        <p>Connect to a sender to see file details...</p>
                    </output>
                    <br>
                    <button id="connectBtn" disabled>âœ… Accept File</button>
                    
                    <details id="answerDisplay" hidden>
                        <summary><strong>ğŸ“¤ Manual Connection Code</strong></summary>
                        <p>Send this code back to the sender if automatic connection fails:</p>
                        <textarea id="answerText" readonly rows="3" style="width: 100%; font-family: monospace; margin: 10px 0;"></textarea>
                        <button id="copyAnswerBtn">ğŸ“‹ Copy Code</button>
                    </details>
                </fieldset>
            </section>
        </div>

        <!-- TRANSFER STATUS -->
        <section id="transfer-section">
            <h2>ï¿½ Transfer Status</h2>
            <fieldset>
                <legend>Progress and connection status</legend>
                <output id="connectionStatus" hidden>
                    Ready to transfer...
                </output>
                <br>
                <progress id="progressBar" value="0" max="100" hidden>0%</progress>
                <output id="progressText">Select a mode above to get started</output>
            </fieldset>
        </section>
    </main>

    <footer>
        <details>
            <summary><strong>ğŸ†˜ Troubleshooting</strong></summary>
            <h3>Common Issues:</h3>
            <dl>
                <dt><strong>Connection failed?</strong></dt>
                <dd>â€¢ Make sure both people have the page open<br>
                    â€¢ Try refreshing and creating a new link<br>
                    â€¢ Check your internet connection</dd>
                
                <dt><strong>Transfer stuck?</strong></dt>
                <dd>â€¢ Don't close the browser tab during transfer<br>
                    â€¢ Large files take longer - be patient<br>
                    â€¢ Try with a smaller file first</dd>
                
                <dt><strong>Can't download?</strong></dt>
                <dd>â€¢ Check if your browser blocked the download<br>
                    â€¢ Look for download notification in browser<br>
                    â€¢ Use a modern browser (Chrome, Firefox, Safari, Edge)</dd>
                
                <dt><strong>Large file problems?</strong></dt>
                <dd>â€¢ Files over 1GB may be slow or fail<br>
                    â€¢ Close other browser tabs to free memory<br>
                    â€¢ Use a wired internet connection if possible<br>
                    â€¢ Consider splitting very large files into parts</dd>
                
                <dt><strong>Browser crashes or freezes?</strong></dt>
                <dd>â€¢ File may be too large for available RAM<br>
                    â€¢ Try with a smaller file (under 500MB)<br>
                    â€¢ Restart browser and try again<br>
                    â€¢ Requires modern browser with WebRTC support</dd>
            </dl>
        </details>
        
        <hr>
        
        <p style="text-align: center; margin-top: 20px;">
            <a href="https://kaddio.com" target="_blank" rel="noopener">ğŸŒ Kaddio.com</a> | 
            <a href="https://github.com/kaddio/p2p" target="_blank" rel="noopener">ğŸ“ GitHub Repository</a>
        </p>
    </footer>

    <script src="p2p-transfer.js"></script>
</body>
</html>